# H2 - Lempiväri: violetti

Tehtävänannot luettavissa https://terokarvinen.com/verkkoon-tunkeutuminen-ja-tiedustelu/

Tehtävien tekoon käytetty laitteisto:
````
Isäntälaite:
CPU: Intel i7-6700K, 4-core (AMD64)
RAM: 32GB
OS: Windows 10
````

````
Virtuaalikone
CPU cores: 4
RAM: 8192MB
SSD: 40GB
OS: Debian 12 Bookworm
Virtualisointi: Virtualbox 7.0.12
````

## X) Lue ja vastaa kysymyksiin

### Bianco: Pyramid of pain

Tuskan pyramidi kuvaa hyökkäysten eri indikaattoreiden tunnistamista ja niiden käytön estämisen hyökkääjälle aiheuttamaa "tuskaa"; pyramidin alaosan estojen kiertäminen on hyökkääjän kannalta helpointa, ja vaikeutuu asteittain pyramidin ylemmille tasoille siirryttäessä. Hyökkääjästä saatua tietoa voidaan pyramidiin verraten hyödyntää uhkien tunnistamisen suunnittelussa. 

Lähde: https://detect-respond.blogspot.com/2013/03/the-pyramid-of-pain.html

### Timanttimalli

Timanttimalli kuvaa tunkeutumisen tutkimisen neljää peruselementtiä(adversary, capability, infrastructure ja victim) ja niiden keskinäisiä suhteita. Peruselementtien ja erilaisen metatiedon sekä tiedon varmuuden asteen kautta tutkimuksia voidaan kohdistaa osa-alueille, joista tietoa ei ole vielä tarpeeksi.   

Lähde: https://www.threatintel.academy/wp-content/uploads/2020/07/diamond-model.pdf

## A) Apache log

Päivitin virtuaalikoneen paketinhallinnan listat ``$ sudo apt-get update`` ja asensin apache2:n komennolla ``$ sudo apt-get install apache2``. Tämän jälkeen käynnistin weppipalvelimen komennolla ``$ sudo systemctl start apache2`` ja testasin selaimella, oliko asennus ja käynnistäminen onnistunut siirtymällä osoitteeseen http://localhost:80. Apachen vakiosivu tervehti iloisesti, joten palvelin oli onnistuneesti käynnistetty. 

![Add file: apache default](/img/h2/apache_1.png)
> Apachen vakioaloitussivu osoitteessa localhost

Debian-koneissa lokitiedostot ovat tyypillisesti hakemiston ``/var/log`` alla. Siirryin hakemistoon komennolla ``$ cd /var/log`` ja listasin sen sisällön komennolla ``$ ls``. Työhakemistossa oli hakemisto apache2, johon yritin ensin siirtyä komennolla ``$ cd apache2``, mutta hakemiston oikeudet(``drwxr-x---``) rajasivat luku- ja suoritusoikeudet vain hakemiston omistajalle(root) ja ryhmälle (adm). Siirryin hetkellisesti pääkäyttäjätilaan komennolla ``$ sudo su``, minkä jälkeen hakemistoon siirtyminen ja access.log-tiedoston lukeminen onnistuivat komennoilla ``$ cd apache2`` ja ``$ cat access.log``. Tämän jälkeen poistuin pääkäyttäjätilasta komennolla ``$ exit``. 

Aiempaan testaukseen viittaava lokirivi:

``127.0.0.1 - - [08/Apr/2025:22:07:30 +0300] "GET / HTTP/1.1" 200 3380 "-" "Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0"``
 - ``127.0.0.1``: IP-osoite, josta pyyntö tullut. Pyyntö tullut laitteelta itseltään. Loopback adapterin IP-osoite on vakiona 127.0.0.1
 - ``- -``: Käyttäjän identd-tunniste ja HTTP-tunnistautumiseen käytetty käyttäjätunnus. Molemmat tässä tapauksessa tyhjiä.
 - ``[08/Apr/2025:22:07:30 +0300]``: Pyynnön aikaleima sekä aikavyöhyke (GMT+3). Aikaleima ja -vyöhyke palvelimen kellon mukaan.
 - ``"GET / HTTP/1.1"``: Vastaanotettu pyyntö. Pyydetty GET-metodilla sivua '/', eli etusivu, HTTP 1.1 -protokollaa hyödyntäen.
 - ``200``: HTTP-statusviesti. 200 = OK, eli pyyntöön vastattu palauttamalla pyydetty sivu.
 - ``3380``: vastauksen koko tavuina
 - ``"-"``: Referer header. Kertoo, miltä sivulta pyyntö ohjattu, jos ohjattu. Ei ohjausta, joten "-".
 - ``"Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0"``: User-agent. Tietoja pyynnön lähettäjän käyttöjärjestelmästä ja selaimesta. Käytössä 64-bittisellä Linuxilla ajettu Mozilla Firefox versio 5.0.

Epäselviin kohtiin (lokimerkintöjen tyhjät kentät/viivat) etsitty tulkita-apua [Stackoverflowsta](https://stackoverflow.com/questions/9234699/understanding-apaches-access-log).

## B) Nmapped

Aloitin asentamalla nmapin komennolla ``$ sudo apt-get install nmap``, minkä jälkeen irrotin varmuuden vuoksi virtuaalikoneen internetistä sulkemalla interfacen enp0s3 komennolla ``$ sudo ifconfig enp0s3 down``. Testasin vielä, että yhteys on varmasti poikki pingaamalla Googlen DNS-palvelinta ``$ ping 8.8.8.8`` ja että pääsy virtuaalikoneella pyörivälle sivulle onnistui komennolla ``$ curl -I localhost``. Käytin ``-I``-parametria lyhentääkseni vastauksen vain HTTP HEAD-tietoihin mahduttaakseni testien tulokset samaan screenshottiin. 

![Add file: ei nettiä, localhostia on](/img/h2/nmap_1.png)
> Ping epäonnistuu verkkoyhteyden puutteesta johtuen. Curl localhost saa vastauksen 200 OK

Esivalmistelut turvallisesti suoritettu, joten porttiskannailemaan. Työkalu oli minulle aiemmilta kursseilta tuttu. Muistelin, että ``$ nmap -A`` kannatti ajaa sudona, sillä skannauksessa lähetettäisiin myös pyyntöjä, jotka eivät peruskäyttäjänä onnistu. 


Skannauksen tulos karsittuna, kommentoituna ja ajettu komento:
````
mato@mato-virtualbox:/var/log$ sudo nmap -A localhost
Starting Nmap 7.93 ( https://nmap.org ) at 2025-04-08 22:56 EEST # skannauksen aloitusaikaleima ja aikavyöhyke (EEST = Itä-Euroopan aikavyöhyke)
mass_dns: warning: Unable to determine any DNS servers. Reverse DNS is disabled. Try using --system-dns or specify valid servers with --dns-servers
Nmap scan report for localhost (127.0.0.1) # Raportti alkaa
Host is up (0.000026s latency). # Palvelin vastaa 0.00026 sekunissa. Olematon viive, joten skannaus osunut varmasti paikalliseen koneeseen. Yleensä vähintään millisekunteja yhteyksien karatessa verkkoon.
Other addresses for localhost (not scanned): ::1 # IPv6-localhostia ei skannattu
Not shown: 997 closed tcp ports (reset)
PORT    STATE SERVICE VERSION
[...]
80/tcp  open  http    Apache httpd 2.4.62 ((Debian)) # Portti 80/tcp auki. Pyörittää HTTP-protokollalla Apache httpd 2.4.62. Käyttöjärjestelmä Debian. Suojaamattoman HTTP-liikenteen vakioportti. 
[...]
Device type: general purpose # Skannatun palvelimen tietoja
Running: Linux 2.6.X
OS CPE: cpe:/o:linux:linux_kernel:2.6.32
OS details: Linux 2.6.32
Network Distance: 0 hops # Liikennettä ei reititetty kertaakaan. Skannaus kohdistunut localhostiin. 
Service Info: Host: mato-virtualbox # Koneen nimi. Tässä yhteydessä vaikea päätellä onko skannauksen suorittajan vai kohteen, koska ovat sama kone. 

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/.
Nmap done: 1 IP address (1 host up) scanned in 9.64 seconds # Skannaus kohdistunut yhteen ip-osoitteeseen, joka vastasi. Skannauksen kesto 9.64 sekuntia. 
````

## C) Skriptit


## D) Jäljet lokissa


## E) Wire sharking


## F) Net grep


## G) Agentti


## H) Pienemmät jäljet


## I) LoWeR ChEcK


## J) Vapaaehtoinen: Invisible, invincible



## Lähteet

Karvinen, 2025: Verkkoon tunkeutuminen ja tiedustelu. Luettavissa https://terokarvinen.com/verkkoon-tunkeutuminen-ja-tiedustelu/.

Bianco, 2013: Pyramid of Pain. Luettavissa https://detect-respond.blogspot.com/2013/03/the-pyramid-of-pain.html. 

Caltagirone et al 2013: Diamond Model. Luettavissa https://www.threatintel.academy/wp-content/uploads/2020/07/diamond-model.pdf. 

Stackoverflow, 2021: Understanding Apache's access log. Luettavissa: https://stackoverflow.com/questions/9234699/understanding-apaches-access-log. 

Wikipedia: Internet Printing Protocol. Luettavissa: https://en.wikipedia.org/wiki/Internet_Printing_Protocol


