# H2 - Lempiväri: violetti

Tehtävänannot luettavissa https://terokarvinen.com/verkkoon-tunkeutuminen-ja-tiedustelu/

Tehtävien tekoon käytetty laitteisto:
````
Isäntälaite:
CPU: Intel i7-6700K, 4-core (AMD64)
RAM: 32GB
OS: Windows 10
````

````
Virtuaalikone
CPU cores: 4
RAM: 8192MB
SSD: 40GB
OS: Debian 12 Bookworm
Virtualisointi: Virtualbox 7.0.12
````

## X) Lue ja vastaa kysymyksiin

### Bianco: Pyramid of pain

Tuskan pyramidi kuvaa hyökkäysten eri indikaattoreiden tunnistamista ja niiden käytön estämisen hyökkääjälle aiheuttamaa "tuskaa"; pyramidin alaosan estojen kiertäminen on hyökkääjän kannalta helpointa, ja vaikeutuu asteittain pyramidin ylemmille tasoille siirryttäessä. Hyökkääjästä saatua tietoa voidaan pyramidiin verraten hyödyntää uhkien tunnistamisen suunnittelussa. 

Lähde: https://detect-respond.blogspot.com/2013/03/the-pyramid-of-pain.html

### Timanttimalli

Timanttimalli kuvaa tunkeutumisen tutkimisen neljää peruselementtiä(adversary, capability, infrastructure ja victim) ja niiden keskinäisiä suhteita. Peruselementtien ja erilaisen metatiedon sekä tiedon varmuuden asteen kautta tutkimuksia voidaan kohdistaa osa-alueille, joista tietoa ei ole vielä tarpeeksi.   

Lähde: https://www.threatintel.academy/wp-content/uploads/2020/07/diamond-model.pdf

## A) Apache log

Päivitin virtuaalikoneen paketinhallinnan listat ``$ sudo apt-get update`` ja asensin apache2:n komennolla ``$ sudo apt-get install apache2``. Tämän jälkeen käynnistin weppipalvelimen komennolla ``$ sudo systemctl start apache2`` ja testasin selaimella, oliko asennus ja käynnistäminen onnistunut siirtymällä osoitteeseen http://localhost:80. Apachen vakiosivu tervehti iloisesti, joten palvelin oli onnistuneesti käynnistetty. 

![Add file: apache default](/img/h2/apache_1.png)
> Apachen vakioaloitussivu osoitteessa localhost

Debian-koneissa lokitiedostot ovat tyypillisesti hakemiston ``/var/log`` alla. Siirryin hakemistoon komennolla ``$ cd /var/log`` ja listasin sen sisällön komennolla ``$ ls``. Työhakemistossa oli hakemisto apache2, johon yritin ensin siirtyä komennolla ``$ cd apache2``, mutta hakemiston oikeudet(``drwxr-x---``) rajasivat luku- ja suoritusoikeudet vain hakemiston omistajalle(root) ja ryhmälle (adm). Siirryin hetkellisesti pääkäyttäjätilaan komennolla ``$ sudo su``, minkä jälkeen hakemistoon siirtyminen ja access.log-tiedoston lukeminen onnistuivat komennoilla ``$ cd apache2`` ja ``$ cat access.log``. 

Aiempaan testaukseen viittaava lokirivi:

``127.0.0.1 - - [08/Apr/2025:22:07:30 +0300] "GET / HTTP/1.1" 200 3380 "-" "Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0"``
 - ``127.0.0.1``: IP-osoite, josta pyyntö tullut. Pyyntö tullut laitteelta itseltään. Loopback adapterin IP-osoite on vakiona 127.0.0.1
 - ``- -``: Käyttäjän identd-tunniste ja HTTP-tunnistautumiseen käytetty käyttäjätunnus. Molemmat tässä tapauksessa tyhjiä.
 - ``[08/Apr/2025:22:07:30 +0300]``: Pyynnön aikaleima sekä aikavyöhyke (GMT+3). Aikaleima ja -vyöhyke palvelimen kellon mukaan.
 - ``"GET / HTTP/1.1"``: Vastaanotettu pyyntö. Pyydetty GET-metodilla sivua '/', eli etusivu HTTP 1.1 -protokollaa hyödyntäen.
 - ``200``: HTTP-statusviesti. 200 = OK, eli pyyntöön vastattu palauttamalla pyydetty sivu.
 - ``3380``: vastauksen koko tavuina
 - ``"-"``: Referer header. Kertoo, miltä sivulta pyyntö ohjattu, jos ohjattu. Ei ohjausta, joten "-".
 - ``"Mozilla/5.0 (X11; Linux x86_64; rv:128.0) Gecko/20100101 Firefox/128.0"``: User-agent. Tietoja pyynnön lähettäjän käyttöjärjestelmästä ja selaimesta. Käytössä 64-bittisellä Linuxilla ajettu Mozilla Firefox versio 5.0.

Epäselviin kohtiin (lokimerkintöjen tyhjät kentät/viivat) etsitty tulkita-apua [Stackoverflowsta](https://stackoverflow.com/questions/9234699/understanding-apaches-access-log).

## B) Nmapped


## C) Skriptit


## D) Jäljet lokissa


## E) Wire sharking


## F) Net grep


## G) Agentti


## H) Pienemmät jäljet


## I) LoWeR ChEcK


## J) Vapaaehtoinen: Invisible, invincible



## Lähteet

Karvinen, 2025: Verkkoon tunkeutuminen ja tiedustelu. Luettavissa https://terokarvinen.com/verkkoon-tunkeutuminen-ja-tiedustelu/.

Bianco, 2013: Pyramid of Pain. Luettavissa https://detect-respond.blogspot.com/2013/03/the-pyramid-of-pain.html. 

Caltagirone et al 2013: Diamond Model. Luettavissa https://www.threatintel.academy/wp-content/uploads/2020/07/diamond-model.pdf. 

Stackoverflow, 2021: Understanding Apache's access log. Luettavissa: https://stackoverflow.com/questions/9234699/understanding-apaches-access-log. 


